# Компилятор

Компиляция программ на своём эзотерическом языке для [собственного `SPU`](https://github.com/ralex2304/Processor) и `x86-64`.

## Содержание

// TODO содержание

## Процесс компиляции

Процесс компиляции:
- лексический разбор текста программы и создание абстрактного синтаксического дерева (AST);
- оптимизации и преобразования AST:
    - свёртка констант;
    - удаление мёртвого кода;
    - дифференцирование математических выражений;
- генерация линейного архитектурно-независимого промежуточного представления;
- оптимизации IR:
    - удаление избыточных парных перемещений данных;
    - свёртка операций со стеком;
- создание бинарного исполняемого файла программы, генерация ассемблерного листинга.

## Зависимости

### Зависимости сборки

1. [`GNU make`](https://www.gnu.org/software/make/) - система сборки
2. [`clang`](https://clang.llvm.org/) - компилятор - можно заменить на `gcc`, изменив четыре `Makefile`
3. [`bear`](https://github.com/rizsotto/Bear) - *необязательно (`make build nobear=1`)* - утилита для создания файла `compile_commands.json`

#### Библиотеки

1. `Tree` и/или `TreeDebug` - [релизы](https://github.com/ralex2304/Tree/releases) - библиотека для работы с бинарными деревьями

##### Установка

Заменить символические ссылки в директории `./lib` на папки с файлами `.h` и `.a`. Скачать их можно в разделе `Releases` соответствующих библиотек

### Зависимости компиляции

1. [`iconv`](https://ru.wikipedia.org/wiki/Iconv) - используется скриптом `compiler.sh` для отображения русских символов в консоли
2. [`graphviz dot`](https://graphviz.org/docs/layouts/dot/) - *необязательно* - графический дамп внутренних структур программ при ошибках (только в Debug версии)

## Использование

### Сборка

```
make build <release=1> <nobear=1>
```

#### Release версия

- опция компиляции `-O2`.

```
make build release=1
```
#### Debug версия

- верификаторы структур данных;
- логирование внутренних ошибок;
- sanitizer;
- опция компиляции `-Og`;
- assert.

```
make build
```

### Компиляция программы

По умолчанию выбраны архитектура `x86-64`

```
./compiler.sh <file>
```

#### Опции компиляции

| Опция              | Описание |
|:-------------------|:---------|
| `--help`           | Вывести опции компиляции
| `-o <file>`        | Задать имя выходного файла
| `-m={spu\|x86_64}` | Выбрать архитектуру
| `-l=<file>`        | Задать имя объектного файла библиотеки ввода/вывода
| `-S`               | Включить генерацию текстового ассемблерного листинга
